<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Sonar</title>
        <meta name="description" content="sonar website">
        <meta name="viewport" content="width=device-width">

        <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

        <link rel="stylesheet" href="/core/css/base.css">
        <link rel="stylesheet" href="/core/css/color.css">
        <link rel="stylesheet" href="/core/css/footer.css">
        <link rel="stylesheet" href="/core/css/helpers.css">
        <link rel="stylesheet" href="/core/css/layouts.css">
        <link rel="stylesheet" href="/core/css/navigation.css">
        <link rel="stylesheet" href="/core/css/search-results.css">
        <link rel="stylesheet" href="/core/css/structure.css">
        <link rel="stylesheet" href="/core/css/type.css">
        <link rel="stylesheet" href="/core/css/highlight.css">
        <link rel="stylesheet" href="/components/breadcrumb/breadcrumb.css">
        <link rel="stylesheet" href="/core/css/controls.css">
            <link rel="stylesheet" href="/core/css/code.css">
            <link rel="stylesheet" href="/core/css/table-of-contents.css">
        <link href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500,600" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css">
    </head>

    <body>
            <header class="header">
                <div class="nav-bar container">
                    <nav class="nav">
                        <a href="/" class="clear"><img src="/images/sonar-logo.svg" alt="sonar" class="header__logo navbar__navitem"></a>
                        <ul class="nav__navbar">
                                <li class="navbar__navitem">
                                    <a role="button" href="/scanner" id="scanner" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-scanner"
                                    class="navitem__button ">Scanner</a>
                                </li>
                                <li class="navbar__navitem">
                                    <a role="button" href="/docs" id="docs" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-docs"
                                    class="navitem__button expandable">Documentation</a>
                                        <ul role="group" id="submenu-docs" class="navbar__submenu" aria-hidden="true">
                                                <li><a href="/docs/developer-guide/">Developer Guide</a></li>
                                                <li><a href="/docs/user-guide/">User Guide</a></li>
                                        </ul>
                                </li>
                                <li class="navbar__navitem">
                                    <a role="button" href="/about/" id="about" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-about"
                                    class="navitem__button expandable">About</a>
                                        <ul role="group" id="submenu-about" class="navbar__submenu" aria-hidden="true">
                                                <li><a href="/about/faq/">Faq</a></li>
                                                <li><a href="/about/governance/">Governance</a></li>
                                                <li><a href="/about/contributors/">Contributors</a></li>
                                                <li><a href="/about/code-of-conduct/">Code of Conduct</a></li>
                                        </ul>
                                </li>
                        </ul>
                        <div class="nav-bar__input">
                            <input type="search" id="search-input" placeholder="Search...">
                        </div>
                    </nav>
                    <button class="header__toggle mobile-nav-button" aria-label="Menu"></button>
                </div>
            </header>
            <main class="container">
                    <article class="content" aria-labelledby="page-heading">
                        <nav class="container breadcrumb" aria-label="breadcrumbs">
                            <ul>
                                <li><a href="/">Home</a></li>
                                <li><a href="../../">Documentation</a></li>
                                <li>
                                    <a href="../../">
                                            Developer Guide
                                    </a>
                                </li>
                                <li aria-current="location">How to test rules</li>
                            </ul>
                        </nav>
                        <header class="page-intro">
                            <h1 id="page-heading">Developer Guide</h1>
                            <p class="subtitle">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum</p>
                        </header>
                        <section class="section">
                            <div class="layout layout--sidebar">
                                <div class="module module--primary">
                                    <h1 id="How-to-test-rules"><a href="#How-to-test-rules" class="headerlink" title="How to test rules"></a>How to test rules</h1><p>Testing a new rule is really easy if you use <code>rule-runner.ts</code>. You just
                    need to:</p>
                    <ul>
                    <li><p>Create a <code>tests.ts</code> file in a folder with the name of the rule
                    (e.g.: <code>src/tests/rules/&lt;rule-id&gt;/tests.ts</code>)</p>
                    </li>
                    <li><p>Have the following template:</p>
                    <figure class="highlight ts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; RuleTest &#125; <span class="keyword">from</span> <span class="string">'../../../helpers/rule-test-type'</span>; <span class="comment">// eslint-disable-line no-unused-vars</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ruleRunner <span class="keyword">from</span> <span class="string">'../../../helpers/rule-runner'</span>;</div><div class="line"><span class="keyword">import</span> &#123; getRuleName &#125; <span class="keyword">from</span> <span class="string">'../../../../src/lib/utils/rule-helpers'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> ruleName = getRuleName(__dirname);</div><div class="line"></div><div class="line"><span class="keyword">const</span> tests: <span class="built_in">Array</span>&lt;RuleTest&gt; = [</div><div class="line">    &#123;</div><div class="line">        name: <span class="string">'Name of the tests'</span>,</div><div class="line">        serverConfig: <span class="string">'HTML to use'</span>,</div><div class="line">        reports: [&#123;</div><div class="line">            message: <span class="string">'Message the error will have'</span>,</div><div class="line">            position: &#123; column: <span class="number">0</span>, line: <span class="number">0</span> &#125; <span class="comment">// Where the error will show.</span></div><div class="line">        &#125;]</div><div class="line">    &#125;,</div><div class="line">    &#123; ... &#125;</div><div class="line">];</div><div class="line"></div><div class="line">ruleRunner.testRule(ruleName, tests);</div></pre></td></tr></table></figure>
                    </li>
                    </ul>
                    <p>The signature of <code>ruleRunner.testRule</code> is:</p>
                    <ul>
                    <li><code>ruleName</code>, the name of the rule.</li>
                    <li><code>tests</code>, an <code>Array&lt;RuleTest&gt;</code>.</li>
                    <li><code>ruleConfig</code>, (optional) to modify the defaults of the rule.</li>
                    <li><code>serial</code>, (optional, defaults to <code>false</code>) to run the tests of that
                    rule serially.</li>
                    </ul>
                    <p><code>serverConfig</code> can be of different types depending on particular needs:</p>
                    <ul>
                    <li><code>string</code> containing the response for <code>/</code> (HTML, plain text, etc.).</li>
                    <li><p><code>object</code> with paths as properties names and their content as values:</p>
                    <!-- eslint-disable no-unused-vars -->
                    <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> serverConfig = &#123;</div><div class="line">    <span class="string">'/'</span>: <span class="string">'some HTML here'</span>,</div><div class="line">    <span class="string">'site.webmanifest'</span>: <span class="string">'other content'</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
                    </li>
                    <li><p>You can even specify the status code for the response for
                    a specific path:</p>
                    <!-- eslint-disable no-unused-vars -->
                    <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> serverConfig = &#123;</div><div class="line">    <span class="string">'/'</span>: <span class="string">'some HTML here'</span>,</div><div class="line">    <span class="string">'/site.webmanifest'</span>: &#123;</div><div class="line">        <span class="attr">content</span>: <span class="string">'The content of the response'</span>,</div><div class="line">        <span class="attr">statusCode</span>: <span class="number">200</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
                    </li>
                    </ul>
                    <p>In the last example, if you don’t specify <code>content</code>, the response
                    will be an empty string <code>&#39;&#39;</code>.</p>
                    <p><code>rule-runner</code> will automatically test the rule in all the supported
                    collectors.</p>
                    <h2 id="Throwing-an-error"><a href="#Throwing-an-error" class="headerlink" title="Throwing an error"></a>Throwing an error</h2><p>If you need to force an error in the <code>collector</code> when visiting a URL
                    you just have to make the content <code>null</code>. This will force a redirect
                    to <code>test://fail</code>, thus, causing an exception.</p>
                    <h2 id="Testing-an-external-url"><a href="#Testing-an-external-url" class="headerlink" title="Testing an external url"></a>Testing an external url</h2><p>If you need to test an external resource (because you are integrating
                    with a third party service) you need to use the property <code>serverUrl</code>:</p>
                    <figure class="highlight ts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> tests: <span class="built_in">Array</span>&lt;RuleTest&gt; = [</div><div class="line">      &#123;</div><div class="line">          name: <span class="string">'Name of the tests'</span>,</div><div class="line">          serverUrl: <span class="string">'https://example.com'</span>,</div><div class="line">          reports: [&#123;</div><div class="line">              message: <span class="string">'Message the error will have'</span></div><div class="line">          &#125;]</div><div class="line">      &#125;,</div><div class="line">      &#123; ... &#125;</div><div class="line">  ];</div></pre></td></tr></table></figure>
                    <h2 id="Execute-code-before-or-after-collecting-the-results"><a href="#Execute-code-before-or-after-collecting-the-results" class="headerlink" title="Execute code before or after collecting the results"></a>Execute code <code>before</code> or <code>after</code> collecting the results</h2><p>In some scenarios you need to execute some code <code>before</code> or <code>after</code>
                    the actual tests (e.g.: if you need to mock a dependency). For those
                    cases you can use the <code>before</code> and <code>after</code> properties of <code>RuleTest</code>:</p>
                    <figure class="highlight ts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> tests: <span class="built_in">Array</span>&lt;RuleTest&gt; = [</div><div class="line">      &#123;</div><div class="line">          after() &#123;</div><div class="line">              <span class="comment">// Code to execute right before calling `collector.close` goes here.</span></div><div class="line">          &#125;</div><div class="line">          before() &#123;</div><div class="line">              <span class="comment">// Code to execute before the creation of the sonar object here.</span></div><div class="line">          &#125;,</div><div class="line">          name: <span class="string">'Name of the tests'</span>,</div><div class="line">          serverUrl: <span class="string">'https://example.com'</span>,</div><div class="line">          reports: [&#123;</div><div class="line">              message: <span class="string">'Message the error will have'</span></div><div class="line">          &#125;]</div><div class="line">      &#125;,</div><div class="line">      &#123; ... &#125;</div><div class="line">  ];</div></pre></td></tr></table></figure>
                    
                                </div>
                                <div class="module module--secondary table-of-contents" role="navigation">
                                            <p class="toc-section-title--active">
                                                <a href="/docs/developer-guide/collectors/index.html">
                                                collectors
                                                </a>
                                            </p>
                                        <ul class="toc-subsection-title">
                                                <li>
                                                    <a href="/docs/developer-guide/collectors/how-to-develop-a-collector.html"
                                                            class="toc-subsection-title"
                                                        >
                                                        How to develop a collector
                                                    </a>
                                                </li>
                                        </ul>
                                            <p class="toc-section-title--active">
                                                <a href="/docs/developer-guide/rules/index.html">
                                                rules
                                                </a>
                                            </p>
                                        <ul class="toc-subsection-title">
                                                <li>
                                                    <a href="/docs/developer-guide/rules/how-to-test-rules.html"
                                                            class="toc-subsection-title--active"
                                                            aria-current="location"
                    >
                                                        How to test rules
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="/docs/developer-guide/rules/how-to-evaluate-javascript.html"
                                                            class="toc-subsection-title"
                                                        >
                                                        How to evaluate JavaScript
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="/docs/developer-guide/rules/how-to-interact-with-other-services.html"
                                                            class="toc-subsection-title"
                                                        >
                                                        How to interact with other services
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="/docs/developer-guide/rules/how-to-create-a-rule.html"
                                                            class="toc-subsection-title"
                                                        >
                                                        How to create a rule
                                                    </a>
                                                </li>
                                        </ul>
                                            <p class="toc-section-title--active">
                                                <a href="/docs/developer-guide/events/index.html">
                                                events
                                                </a>
                                            </p>
                                        <ul class="toc-subsection-title">
                                                <li>
                                                    <a href="/docs/developer-guide/events/list-of-events.html"
                                                            class="toc-subsection-title"
                                                        >
                                                        List of events emitted by a collector
                                                    </a>
                                                </li>
                                        </ul>
                                        <ul class="toc-subsection-title">
                                        </ul>
                                </div>
                            </div>
                        </section>
                    </article>


            </main>
        <script src="/js/script.js"></script>
        <script src="/core/scripts/form-validation.js"></script>
        <script src="/components/accordion/accordion.js"></script>
        <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
        <script>
            docsearch({
                apiKey: '2ee58f908e6d720c4f72a9645ce0e857', // search-only API key, okay for frontend
                indexName: 'sonarwhal',
                inputSelector: '#search-input',
                appId: '0R8E5SPAFP',
                debug: true // set to true if need to debug css
            });
        </script>
    </body>
</html>
