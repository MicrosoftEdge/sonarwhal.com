<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Sonar</title>
        <meta name="description" content="sonar website">
        <meta name="viewport" content="width=device-width">

        <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

        <link rel="stylesheet" href="/core/css/base.css">
        <link rel="stylesheet" href="/core/css/color.css">
        <link rel="stylesheet" href="/core/css/footer.css">
        <link rel="stylesheet" href="/core/css/helpers.css">
        <link rel="stylesheet" href="/core/css/layouts.css">
        <link rel="stylesheet" href="/core/css/navigation.css">
        <link rel="stylesheet" href="/core/css/search-results.css">
        <link rel="stylesheet" href="/core/css/structure.css">
        <link rel="stylesheet" href="/core/css/type.css">
        <link rel="stylesheet" href="/core/css/highlight.css">
        <link rel="stylesheet" href="/components/breadcrumb/breadcrumb.css">
        <link rel="stylesheet" href="/core/css/controls.css">
            <link rel="stylesheet" href="/core/css/code.css">
            <link rel="stylesheet" href="/core/css/table-of-contents.css">
        <link href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500,600" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css">
    </head>

    <body>
            <header class="header">
                <div class="nav-bar container">
                    <nav class="nav">
                        <a href="/" class="clear"><img src="/images/sonar-logo.svg" alt="sonar" class="header__logo navbar__navitem"></a>
                        <ul class="nav__navbar">
                                <li class="navbar__navitem">
                                    <a role="button" href="/scanner" id="scanner" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-scanner"
                                    class="navitem__button ">Scanner</a>
                                </li>
                                <li class="navbar__navitem">
                                    <a role="button" href="/docs" id="docs" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-docs"
                                    class="navitem__button expandable">Documentation</a>
                                        <ul role="group" id="submenu-docs" class="navbar__submenu" aria-hidden="true">
                                                <li><a href="/docs/developer-guide/">Developer Guide</a></li>
                                                <li><a href="/docs/user-guide/">User Guide</a></li>
                                        </ul>
                                </li>
                                <li class="navbar__navitem">
                                    <a role="button" href="/about/" id="about" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-about"
                                    class="navitem__button expandable">About</a>
                                        <ul role="group" id="submenu-about" class="navbar__submenu" aria-hidden="true">
                                                <li><a href="/about/faq/">Faq</a></li>
                                                <li><a href="/about/governance/">Governance</a></li>
                                                <li><a href="/about/contributors/">Contributors</a></li>
                                                <li><a href="/about/code-of-conduct/">Code of Conduct</a></li>
                                        </ul>
                                </li>
                        </ul>
                        <div class="nav-bar__input">
                            <input type="search" id="search-input" placeholder="Search...">
                        </div>
                    </nav>
                    <button class="header__toggle mobile-nav-button" aria-label="Menu"></button>
                </div>
            </header>
            <main class="container">
                    <article class="content" aria-labelledby="page-heading">
                        <nav class="container breadcrumb" aria-label="breadcrumbs">
                            <ul>
                                <li><a href="/">Home</a></li>
                                <li><a href="../../">Documentation</a></li>
                                <li>
                                    <a href="../../">
                                            Developer Guide
                                    </a>
                                </li>
                                <li aria-current="location">How to develop a rule</li>
                            </ul>
                        </nav>
                        <header class="page-intro">
                            <h1 id="page-heading">Developer Guide</h1>
                            <p class="subtitle">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum</p>
                        </header>
                        <section class="section">
                            <div class="layout layout--sidebar">
                                <div class="module module--primary">
                                    <h1 id="Howtodeveloparule"><a href="#Howtodeveloparule" class="headerlink" title="How to develop a rule"></a>How to develop a rule</h1><p>To create a new rule you just need to:</p>
                    <ul>
                    <li><p>Create a <code>&lt;rule_name&gt;.ts</code> file in a folder with the same name
                    of the rule file (e.g.: <code>src/rules/&lt;rule_name&gt;/&lt;rule_name&gt;.ts</code>).</p>
                    </li>
                    <li><p>Have the following template:</p>
                    <figure class="highlight ts"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">from</span> <span class="string">'../../utils/rule-helpers'</span>;</div><div class="line"><span class="comment">// The list of types depends on the [events](/undefined) you want to capture.</span></div><div class="line"><span class="keyword">import</span> &#123; IFetchEndEvent, IRule, IRuleBuilder &#125; <span class="keyword">from</span> <span class="string">'../../types'</span>; <span class="comment">// eslint-disable-line no-unused-vars</span></div><div class="line"><span class="keyword">import</span> &#123; RuleContext &#125; <span class="keyword">from</span> <span class="string">'../../rule-context'</span>; <span class="comment">// eslint-disable-line no-unused-vars</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> rule: IRuleBuilder = &#123;</div><div class="line">    create(context: RuleContext): IRule &#123;</div><div class="line">        <span class="comment">// Your code here.</span></div><div class="line"></div><div class="line">        <span class="keyword">const</span> validateFetchEnd = <span class="function">(<span class="params">fetchEnd: IFetchEndEvent</span>) =&gt;</span> &#123;</div><div class="line">            <span class="comment">// Code to validate the rule on the event fetch::end.</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">const</span> validateTargetFetchEnd = <span class="function">(<span class="params">targetFetchEnd: IFetchEndEvent</span>) =&gt;</span> &#123;</div><div class="line">            <span class="comment">// Code to validate the rule on the event targetfetch::end.</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">          <span class="string">'fetch::end'</span>: validateFetchEnd,</div><div class="line">          <span class="string">'targetfetch::end'</span>: validateTargetFetchEnd</div><div class="line">          <span class="comment">// As many events as you need, you can see the</span></div><div class="line">          <span class="comment">// list of events [here](/undefined).</span></div><div class="line">      &#125;;</div><div class="line">    &#125;,</div><div class="line">    meta: &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
                    </li>
                    </ul>
                    <blockquote>
                    <p>More content here</p>
                    </blockquote>
                    <h2 id="Targetspecificbrowsers"><a href="#Targetspecificbrowsers" class="headerlink" title="Target specific browsers"></a>Target specific browsers</h2><p>If your rule only applies to specific browsers you should use
                    <code>context.targetedBrowsers</code> and check if the rule needs to be
                    executed or not.</p>
                    <!-- eslint-disable no-unused-vars -->
                    <figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> validateFetchEnd = <span class="function">(<span class="params">fetchEnd</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">if</span> (!context.targetedBrowsers.includes(<span class="string">'Edge 14'</span>)) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Your validations</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
                    <h2 id="Reportinganerrorifnotrun"><a href="#Reportinganerrorifnotrun" class="headerlink" title="Reporting an error if not run"></a>Reporting an error if not run</h2><p>Sometimes what a rule checks is mandatory, and if it does not have
                    the change to test it, it should fail. These are the types of rules
                    that enforce certain things to be used in a certain way, and if
                    included, in order for the rule to pass, the expectation should be
                    that the thing the rule checks for should exist and be valid/used
                    correctly. Examples here are the rules that check for different fields
                    of the manifest file. They should not pass if, for example, the web
                    manifest file doesn’t exist (even if there is a rule that checks
                    exactly that).</p>
                    <p>The recommended way to implement a rule like this is to subscribe
                    to the event <code>scan::end</code>. If your rule receives that event and has
                    not run any validation you should report it.</p>
                    <h2 id="Interactwithotherservices"><a href="#Interactwithotherservices" class="headerlink" title="Interact with other services"></a>Interact with other services</h2><p>You can develop a rule that integrates with other services. <code>sonar</code>
                    integrates with a few like <code>ssllabs</code>.
                    Because these online tools usually take a few seconds to return the
                    results the guidance is to start the analysis as soon as possible
                    and then collect the results as late as possible. This means you
                    will have to listen to <code>scan::start</code> and <code>scan::end</code>
                    events respectively.
                    The <code>create</code> method of your rule should be similar to the following:</p>
                    <figure class="highlight ts"><table><tr><td class="code"><pre><div class="line">create(context: RuleContext): IRule &#123;</div><div class="line">    <span class="comment">/** The promise that represents the connection to the online service. */</span></div><div class="line">    <span class="keyword">let</span> promise: <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> start = <span class="function">(<span class="params">data: IScanStartEvent</span>) =&gt;</span> &#123;</div><div class="line">        <span class="comment">// Initialize promise to service here but do not return it.</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> end = (data: IScanEndEvent): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; =&gt; &#123;</div><div class="line">        <span class="keyword">return</span> promise</div><div class="line">            .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</div><div class="line">                <span class="comment">// Report any results via `context.report` here.</span></div><div class="line">            &#125;)</div><div class="line">            .catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">                <span class="comment">// Always good to handle errors.</span></div><div class="line">            &#125;);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="string">'scan::start'</span>: start,</div><div class="line">        <span class="string">'scan::end'</span>: end</div><div class="line">    &#125;;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
                    <p>In case you need a more complete example, please look at the
                    <code>ssllabs.ts</code> source code.</p>
                    <h2 id="EvaluateJavaScriptinthepagecontext"><a href="#EvaluateJavaScriptinthepagecontext" class="headerlink" title="Evaluate JavaScript in the page context"></a>Evaluate JavaScript in the page context</h2><p>Sometimes a rule needs to evaluate some JavaScript in the context of
                    the page. To do that you need to use <code>context.evaluate</code>. This method
                    will always return a <code>Promise</code> even if your code does not return one.</p>
                    <p>One important thing is that your code needs to be wrapped in an
                    immediate invoked function expression (IIFE)</p>
                    <p>The following scripts will work:</p>
                    <!-- eslint-disable -->
                    <figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> script =</div><div class="line"><span class="string">`(function() &#123;</span></div><div class="line">    return true;</div><div class="line">&#125;())`;</div><div class="line"></div><div class="line">context.evaluate(script);</div></pre></td></tr></table></figure>
                    <figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> script =</div><div class="line"><span class="string">`(function() &#123;</span></div><div class="line">    return Promise.resolve(true);</div><div class="line">&#125;())`;</div><div class="line"></div><div class="line">context.evaluate(script);</div></pre></td></tr></table></figure>
                    <p>The following does not:</p>
                    <figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> script = <span class="string">`return true;`</span>;</div><div class="line"></div><div class="line">context.evaluate(script);</div></pre></td></tr></table></figure>
                    <figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> script = <span class="string">`return Promise.resolve(true);`</span>;</div><div class="line"></div><div class="line">context.evaluate(script);</div></pre></td></tr></table></figure>
                    <h2 id="Ignorecollectors"><a href="#Ignorecollectors" class="headerlink" title="Ignore collectors"></a>Ignore collectors</h2><p>If your rule does not work propertly with certain collectors you can
                    use the property <code>ignoreCollectors</code> so it is not run if using them.</p>
                    <!-- eslint-disable no-unused-vars, object-curly-newline -->
                    <figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> rule = &#123;</div><div class="line">    create(context) &#123; <span class="comment">// Your code here</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">meta</span>: &#123;</div><div class="line">        <span class="attr">ignoredCollectors</span>: [<span class="string">'jsdom'</span>]</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
                    
                                </div>
                                <div class="module module--secondary table-of-contents" role="navigation">
                                        <ul class="toc-subsection-title">
                                        </ul>
                                            <p class="toc-section-title--active">
                                                <a href="/docs/developer-guide/collectors/index.html">
                                                collectors
                                                </a>
                                            </p>
                                        <ul class="toc-subsection-title">
                                                <li>
                                                    <a href="/docs/developer-guide/collectors/events.html"
                                                            class="toc-subsection-title"
                                                        >
                                                        Events
                                                    </a>
                                                </li>
                                        </ul>
                                            <p class="toc-section-title--active">
                                                <a href="/docs/developer-guide/rules/how-to-test-rules.html">
                                                rules
                                                </a>
                                            </p>
                                        <ul class="toc-subsection-title">
                                                <li>
                                                    <a href="/docs/developer-guide/rules/index.html"
                                                            class="toc-subsection-title--active"
                                                            aria-current="location"
                    >
                                                        How to develop a rule
                                                    </a>
                                                </li>
                                        </ul>
                                            <p class="toc-section-title--active">
                                                <a href="/docs/developer-guide/formatters/index.html">
                                                formatters
                                                </a>
                                            </p>
                                        <ul class="toc-subsection-title">
                                        </ul>
                                </div>
                            </div>
                        </section>
                    </article>


            </main>
            <footer class="footer footer--home">
                <div class="footer-nav container">
                    <div class="footer-nav__item">
                        <p class="category">Scanner</p>
                        <ul>
                            <li>
                                <a href="/scanner">New scan</a>
                            </li>
                        </ul>
                    </div>
                    <div class="footer-nav__item">
                        <p class="category">Documentation</p>
                        <ul>
                            <li>
                                <a href="/docs/user-guide/">User Guide</a>
                            </li>
                            <li>
                                <a href="/docs/developer-guide/rules/">Rules</a>
                            </li>
                            <li>
                                <a href="/docs/developer-guide/">Developer Guide</a>
                            </li>
                        </ul>
                    </div>
                    <div class="footer-nav__item">
                        <p class="category">
                            About
                        </p>
                        <ul>
                            <li>
                                <a href="/about/faq">FAQ</a>
                            </li>
                            <li>
                                <a href="/about/governance/">Governance</a>
                            </li>
                            <li>
                                <a href="/about/contributors/">Contributors</a>
                            </li>
                            <li>
                                <a href="/about/code-of-conduct/">Code of Conduct</a>
                            </li>
                            <li>
                                <a href="/about/changelog/">Changelog</a>
                            </li>
                        </ul>
                    </div>
                    <div class="footer-nav__item github-icon">
                        <a href="https://github.com/sonarwhal">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25"><path class="github-icon-svg" d="M12.5.4C5.7.4.2 5.9.2 12.7c0 5.4 3.5 10 8.4 11.7.6.1.8-.3.8-.6v-2.1C6 22.4 5.3 20 5.3 20c-.6-1.4-1.4-1.8-1.4-1.8-1.1-.7.1-.7.1-.7 1.2.1 1.9 1.3 1.9 1.3 1.1 1.9 2.9 1.3 3.6 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.6-1.4-5.6-6.1 0-1.3.5-2.4 1.3-3.3-.2-.4-.6-1.6 0-3.3 0 0 1-.3 3.4 1.3 1-.3 2-.4 3.1-.4 1 0 2.1.1 3.1.4C17.9 5.2 19 5.5 19 5.5c.7 1.7.2 2.9.1 3.3.8.9 1.3 2 1.3 3.3 0 4.7-2.9 5.8-5.6 6.1.4.4.8 1.1.8 2.3v3.4c0 .3.2.7.8.6 4.9-1.6 8.4-6.2 8.4-11.7C24.8 5.9 19.3.4 12.5.4"/></svg>
                        </a>
                    </div>
                </div>
            </footer>
        <script src="/js/script.js"></script>
        <script src="/core/scripts/form-validation.js"></script>
        <script src="/components/accordion/accordion.js"></script>
        <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
        <script>
            docsearch({
                apiKey: '2ee58f908e6d720c4f72a9645ce0e857', // search-only API key, okay for frontend
                indexName: 'sonarwhal',
                inputSelector: '#search-input',
                appId: '0R8E5SPAFP',
                debug: true // set to true if need to debug css
            });
        </script>
    </body>
</html>
